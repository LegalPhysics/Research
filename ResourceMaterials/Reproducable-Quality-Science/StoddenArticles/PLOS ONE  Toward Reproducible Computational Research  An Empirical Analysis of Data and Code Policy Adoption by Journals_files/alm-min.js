$.fn.alm=function(){this.almHost=$("meta[name=almHost]").attr("content");this.almAPIKey=$("meta[name=almAPIKey]").attr("content");if(!this.almHost){this.almHost="ALM_HOST_NOT_CONFIGURED"}if(!this.almAPIKey){this.almAPIKey="ALM_KEY_NOT_CONFIGURED"}this.isNewArticle=function(c){var b=(new Date()).getTime()-172800000;if(b<c){return true}else{return false}};this.isArticle=function(b){if(b.indexOf("image")>-1){return false}return true};this.validateDOI=function(b){if(b==null){throw new Error("DOI is null.")}b=encodeURI(b);return b.replace(new RegExp("/","g"),"%2F").replace(new RegExp(":","g"),"%3A")};this.getCitesTwitterOnly=function(c,e,b){c=this.validateDOI(c);var d=c+"&source=twitter&info=event";this.getData(d,e,b)};this.getArticleSummaries=function(e,d,b){idString="";idString+=this.validateDOI(e[0]);for(a=1;a<e.length;a++){idString+=","+this.validateDOI(e[a])}var c=idString;this.getData(c,d,b)};this.sortByYearMonth=function(b,c){if(parseInt(b.year)<parseInt(c.year)){return -1}else{if(parseInt(b.year)==parseInt(c.year)){if(parseInt(b.month)==parseInt(c.month)){return 0}else{if(parseInt(b.month)<parseInt(c.month)){return -1}else{return 1}}}else{return 1}}};this.massageChartData=function(c,j){var p=new Date(j);var e=p.getFullYear();var b=p.getMonth()+1;var d=null;var l=null;var i={};for(var w=0;w<c.length;w++){if(c[w].name.toLowerCase()=="counter"){d=c[w].events;d=d.sort(this.sortByYearMonth)}if(c[w].name.toLowerCase()=="pmc"){if(c[w].events&&c[w].events.length>0){l=c[w].events;l=l.sort(this.sortByYearMonth)}}if(c[w].name.toLowerCase().toLowerCase()=="relativemetric"){if(c[w].events!=null){i.relativeMetricData=c[w].events}}}i.totalPDF=0;i.totalXML=0;i.totalHTML=0;i.total=0;i.history={};for(var w=0;w<d.length;w++){if(d[w].year<e||(d[w].year==e&&d[w].month<b)){d.splice(w,1);w--}}var h=0;var r=0;var n=0;var u=0;for(var w=0;w<d.length;w++){var o=d[w];var v=this.parseIntSafe(o.html_views)+this.parseIntSafe(o.xml_views)+this.parseIntSafe(o.pdf_views);var k=this.getYearMonth(o.year,o.month);i.history[k]={};i.history[k].source={};i.history[k].year=o.year;i.history[k].month=o.month;i.history[k].source.counterViews={};i.history[k].source.counterViews.month=o.month;i.history[k].source.counterViews.year=o.year;i.history[k].source.counterViews.totalPDF=this.parseIntSafe(o.pdf_views);i.history[k].source.counterViews.totalXML=this.parseIntSafe(o.xml_views);i.history[k].source.counterViews.totalHTML=this.parseIntSafe(o.html_views);i.history[k].source.counterViews.total=v;h+=this.parseIntSafe(o.pdf_views);r+=this.parseIntSafe(o.xml_views);n+=this.parseIntSafe(o.html_views);u+=v;i.history[k].source.counterViews.cumulativePDF=h;i.history[k].source.counterViews.cumulativeXML=r;i.history[k].source.counterViews.cumulativeHTML=n;i.history[k].source.counterViews.cumulativeTotal=u;i.history[k].cumulativeTotal=this.parseIntSafe(i.total)+v;i.history[k].cumulativePDF=i.totalPDF+this.parseIntSafe(o.pdf_views);i.history[k].cumulativeXML=i.totalXML+this.parseIntSafe(o.xml_views);i.history[k].cumulativeHTML=i.totalHTML+this.parseIntSafe(o.html_views);i.history[k].total=v;i.totalPDF+=this.parseIntSafe(o.pdf_views);i.totalXML+=this.parseIntSafe(o.xml_views);i.totalHTML+=this.parseIntSafe(o.html_views);i.total+=v}i.totalCounterPDF=h;i.totalCounterXML=r;i.totalCounterHTML=n;i.totalCouterTotal=u;var q=0;var t=0;var f=0;if(l!=null){for(var w=0;w<l.length;w++){var o=l[w];var v=this.parseIntSafe(o["full-text"])+this.parseIntSafe(o.pdf);q+=this.parseIntSafe(o.pdf);t+=this.parseIntSafe(o["full-text"]);f+=v;var k=this.getYearMonth(o.year,o.month);if(i.history[k]==null){continue}i.history[k].source.pmcViews={};i.history[k].source.pmcViews.month=o.month;i.history[k].source.pmcViews.year=o.year;i.history[k].source.pmcViews.cumulativePDF=q;i.history[k].source.pmcViews.cumulativeHTML=t;i.history[k].source.pmcViews.cumulativeTotal=f;i.history[k].source.pmcViews.totalPDF=this.parseIntSafe(o.pdf);i.history[k].source.pmcViews.totalXML="n.a.";i.history[k].source.pmcViews.totalHTML=this.parseIntSafe(o["full-text"]);i.history[k].source.pmcViews.total=v;i.history[k].total+=v;i.history[k].cumulativeTotal+=v;i.history[k].cumulativePDF+=this.parseIntSafe(o.pdf);i.history[k].cumulativeHTML+=this.parseIntSafe(o["full-text"]);i.totalPDF+=this.parseIntSafe(o.pdf);i.totalHTML+=this.parseIntSafe(o["full-text"]);i.total+=v}}i.totalPMCPDF=q;i.totalPMCHTML=t;i.totalPMCTotal=f;for(year=e;year<=(new Date().getFullYear());year++){var s=(year==e)?b:1;for(month=s;month<13;month++){if(year==(new Date().getFullYear())&&(month-1)>(new Date().getMonth())){break}k=this.getYearMonth(year,month);if(i.history[k]!=null&&i.history[k].source.pmcViews==null){i.history[k].source.pmcViews={};i.history[k].source.pmcViews.month=month+1;i.history[k].source.pmcViews.year=year;i.history[k].source.pmcViews.cumulativePDF=0;i.history[k].source.pmcViews.cumulativeHTML=0;i.history[k].source.pmcViews.cumulativeTotal=0;i.history[k].source.pmcViews.totalPDF=0;i.history[k].source.pmcViews.totalXML=0;i.history[k].source.pmcViews.totalHTML=0;
i.history[k].source.pmcViews.total=0;var x=0;var g=0;if(month==1){x=12;g=year-1}else{x=month-1;g=year}var m=this.getYearMonth(g,x);if(i.history[m]!=null&&i.history[m].source.pmcViews!=null){i.history[k].source.pmcViews.cumulativePDF=i.history[m].source.pmcViews.cumulativePDF;i.history[k].source.pmcViews.cumulativeHTML=i.history[m].source.pmcViews.cumulativeHTML;i.history[k].source.pmcViews.cumulativeTotal=i.history[m].source.pmcViews.cumulativeTotal;i.history[k].source.pmcViews.totalPDF=0;i.history[k].source.pmcViews.totalHTML=0;i.history[k].source.pmcViews.total=0}else{i.history[k].source.pmcViews.cumulativePDF=0;i.history[k].source.pmcViews.cumulativeHTML=0;i.history[k].source.pmcViews.cumulativeTotal=0;i.history[k].source.pmcViews.totalPDF=0;i.history[k].source.pmcViews.totalHTML=0;i.history[k].source.pmcViews.total=0}}}}if(i.totalPMCTotal==0){i.totalPMCPDF=0;i.totalPMCHTML=0;i.totalPMCTotal=0}return i};this.parseIntSafe=function(b){if(isNaN(b)){return 0}return parseInt(b)};this.getYearMonth=function(b,c){if(this.parseIntSafe(c)<10){return b+"-0"+c}else{return b+"-"+c}};this.setCrossRefText=function(b,g,e,c){var d=function(h){var i=$("#"+e);i.html("Citations are currently not available, please check back later.");i.show("blind",500);$("#"+c).fadeOut("slow")};var f=function(h){this.setCrossRefLinks(h,g);$("#"+c).fadeOut("slow")};this.getCitesCrossRefOnly(b,jQuery.proxy(f,this),d)};this.getCitesCrossRefOnly=function(c,e,b){c=this.validateDOI(c);var d=c+"&source=crossref&info=event";this.getData(d,e,b)};this.setCrossRefLinks=function(d,c){var m=encodeURIComponent(d[0].doi);var k=this.filterSources(d[0].sources,["crossref"])[0];var o=0;if(k.metrics.total>0){o=k.metrics.total;var h="";for(var b=0;b<k.events.length;b++){var l=k.events[b].event;var n=k.events[b].event_url;h=h+"<li><span class='article'><a href=\""+n+'">'+l.article_title+'</a> <span class="pubGetPDFLink" id="citation_'+this.fixDoiForID(l.doi)+'"></span></span>';if(l.contributors){var f="";var p="";var e="";var j=l.contributors.contributor;for(var g=0;g<j.length;g++){individualContributor=j[g];if(individualContributor.first_author==="true"){if(individualContributor.surname){f=individualContributor.surname;if(individualContributor.given_name&&individualContributor.given_name.length>0){f=f+" "+individualContributor.given_name.substr(0,1)}}}else{e="";if(individualContributor.surname){e=individualContributor.surname;if(individualContributor.given_name&&individualContributor.given_name.length>0){e=e+" "+individualContributor.given_name.substr(0,1)}p=p+", "+e}}}p=f+p;h=h+"<span class='authors'>"+p+"</span>"}h=h+"<span class='articleinfo'>";if(l.journal_title!=null){h=h+l.journal_title}if(l.year!=null){h=h+" "+l.year}if(l.volume!=null){h=h+" "+l.volume}if(l.issue!=null){h=h+"("+l.issue+")"}if(l.first_page){h=h+": "+l.first_page}h=h+". doi:"+l.doi+"</span></li>"}}if(o<1){h="<h3>No related citations found</h3>"}else{var q="";if(o!=1){q="s"}h=o+" citation"+q+' as recorded by <a href="http://www.crossref.org">CrossRef</a>.  Article published '+$.datepicker.formatDate("M dd, yy",new Date(d[0].publication_date))+". Citations updated on "+$.datepicker.formatDate("M dd, yy",new Date(d[0].update_date))+". <ol>"+h+"</ol>"}$("#"+c).html(h);$("#"+c).show("blind",500)};this.fixDoiForID=function(b){return b.replace(/\//g,":")};this.getData=function(d,e,b){var c=this.almHost+"?api_key="+this.almAPIKey+"&ids="+d;$.jsonp({url:c,context:document.body,timeout:20000,callbackParameter:"callback",success:e,error:function(g,f){b("Our system is having a bad day. We are working on it. Please check back later.")}});console.log(c)};this.setSavedSuccess=function(g,d,f){var j=$("#"+d);$("#"+f).fadeOut("slow");j.css("display","none");var c=this.filterSources(g[0].sources,["citeulike","connotea","mendeley"]);c=this.enforceOrder(c,["citeulike","connotea","mendeley"]);var h=true;for(var k=0;k<c.length;k++){var b=c[k];if(b.metrics.total>0){h=false;switch(b.name){case"mendeley":j.append(this.createMetricsTile(b.display_name,b.events_url,"/images/logo-"+b.name+".png",b.metrics.total)+"\n");var i=b.metrics.shares;var e=b.metrics.groups;$("#MendeleyImageOnArticleMetricsTab").tooltip({backgroundColor:"rgba(255, 255, 255, 0.0)",delay:250,fade:250,track:true,shadow:false,showURL:false,bodyHandler:function(){return $('<div class="tileTooltip"><table class="tile_mini"><thead><tr><th>Individuals</th><th>Groups</th></tr></thead><tbody><tr><td class="data1">'+i.format(0,".",",")+'</td><td class="data2">'+e.format(0,".",",")+"</td></tr></tbody></table></div>")}});break;case"connotea":j.append(this.createMetricsTileNoLink(b.display_name,"/images/logo-"+b.name+".png",b.metrics.total)+"\n");break;default:j.append(this.createMetricsTile(b.display_name,b.events_url,"/images/logo-"+b.name+".png",b.metrics.total)+"\n");break}}}if(h){$("#socialNetworksOnArticleMetricsPage").css("display","none")}else{j.show("blind",500)}};this.setSavedError=function(c,d,b){$("#"+b).fadeOut("slow");$("#"+d).html('<img src="/images/icon_error.png"/>&nbsp;'+c);
$("#"+d).show("blind",500)};this.createMetricsTile=function(c,b,e,d){return'<div id="'+c+'OnArticleMetricsTab" class="metrics_tile"><a href="'+b+'"><img id="'+c+'ImageOnArticleMetricsTab" src="'+e+'" alt="'+d+" "+c+'" class="metrics_tile_image"/></a><div class="metrics_tile_footer" onclick="location.href=\''+b+'\';"><a href="'+b+'">'+d+"</a></div></div>"};this.createMetricsTileNoLink=function(b,d,c){return'<div id="'+b+'OnArticleMetricsTab" class="metrics_tile_no_link"><img id="'+b+'ImageOnArticleMetricsTab" src="'+d+'" alt="'+c+" "+b+'" class="metrics_tile_image"/><div class="metrics_tile_footer_no_link">'+c+"</div></div>"};this.setDiscussedSuccess=function(f,m,d){$("#"+d).fadeOut("slow");var h=$("#"+m);h.css("display","none");var g=$("meta[name=citation_title]").attr("content");var l=encodeURI($("meta[name=citation_doi]").attr("content"));var i="",c=null,o="";var b=this.filterSources(f[0].sources,["researchblogging","scienceseeker","nature","wikipedia","twitter","facebook"]);b=this.enforceOrder(b,["researchblogging","scienceseeker","nature","wikipedia","twitter","facebook"]);for(var n=0;n<b.length;n++){c=b[n];i="";if(c.metrics.total>0){if(c.name==="facebook"){i=this.createMetricsTileNoLink(c.display_name,"/images/logo-"+c.name+".png",c.metrics.total)+"\n";var e=c.metrics.likes;var k=c.metrics.shares;var j=c.metrics.comments;o='<div class="tileTooltip"><table class="tile_mini"><thead><tr><th>Likes</th><th>Shares</th><th>Posts</th></tr></thead><tbody><tr><td class="data1">'+e.format(0,".",",")+'</td><td class="data2">'+k.format(0,".",",")+'</td><td class="data1">'+j.format(0,".",",")+"</td></tr></tbody></table></div>"}else{if(c.name==="twitter"){i=this.createMetricsTile(c.display_name,"/article/twitter/info:doi/"+l,"/images/logo-"+c.name+".png",c.metrics.total)+"\n"}else{if(!c.events_url){i=this.createMetricsTileNoLink(c.display_name,"/images/logo-"+c.name+".png",c.metrics.total)+"\n"}else{i=this.createMetricsTile(c.display_name,c.events_url,"/images/logo-"+c.name+".png",c.metrics.total)+"\n"}}}if(i.length>0){h.append(i)}}}$("#notesAndCommentsOnArticleMetricsTab").appendTo(h);$("#trackbackOnArticleMetricsTab").appendTo(h);i=this.createMetricsTile("google-blogs","http://blogsearch.google.com/blogsearch?as_q=%22"+g+"%22","/images/logo-googleblogs.png","Search")+"\n";h.append(i);$("#FacebookOnArticleMetricsTab").tooltip({delay:250,fade:250,track:true,showURL:false,bodyHandler:function(){return $(o)}});h.show("blind",500)};this.setDiscussedError=function(g,b,c){var e=$("#"+b);e.css("display","none");var f=$("meta[name=citation_title]").attr("content");var d="Search for related blog posts on <a href='http://blogsearch.google.com/blogsearch?as_q=%22"+f+"%22'>Google Blogs</a><br/><img src='/images/icon_error.png'/>&nbsp;"+g;e.html(d);$("#"+c).fadeOut("slow");e.show("blind",500)};this.setCitesSuccess=function(g,e,f){$("#"+f).fadeOut("slow");$("#"+e).css("display","none");var j=0;var k=encodeURI($("meta[name=citation_doi]").attr("content"));var i="";var c=this.filterSources(g[0].sources,["crossref","pubmed","scopus","wos"]);c=this.enforceOrder(c,["scopus","crossref","pubmed","wos"]);for(var l=0;l<c.length;l++){source=c[l];if(source.metrics.total>0){var d=source.events_url;var h=/\s/g;var b=source.display_name.toLowerCase().replace(h,"-");b=b.replace("\u00ae","");if(source.name.toLowerCase()=="crossref"){i=i+this.createMetricsTile(b,"/article/crossref/info:doi/"+k,"/images/logo-"+b+".png",source.metrics.total)+"\n";j++}else{if(source.events_url){i=i+this.createMetricsTile(b,d,"/images/logo-"+b+".png",source.metrics.total)+"\n";j++}}}}var m="http://dx.plos.org/"+k.replace("info%3Adoi/","");if(j==0){i='No related citations found<br/>Search for citations in <a href="http://scholar.google.com/scholar?hl=en&lr=&cites='+m+'">Google Scholar</a>'}else{i=i+this.createMetricsTile("googleScholar","http://scholar.google.com/scholar?hl=en&lr=&cites="+m,"/images/logo-google-scholar.png","Search")}$("#"+e).html(i);$("#"+e).show("blind",500)};this.setCitesError=function(d,b,c){$("#"+c).fadeOut("slow");$("#"+b).html('<img src="/images/icon_error.png"/>&nbsp;'+d);$("#"+b).show("blind",500)};this.setF1000Success=function(f,e,d,g){var b=this.filterSources(f[0].sources,["f1000"]).pop();if(!b){return}if(b.metrics.total==0){return}var c=encodeURI($("meta[name=citation_doi]").attr("content"));$("#"+e).show("blind",500);$("#"+d).fadeOut("slow");$("#"+g).append(this.createMetricsTile(b.display_name,b.events_url,"/images/logo-"+b.name+".png",b.metrics.total)+"\n").show("blind",500)};this.setF1000Error=function(b){};this.setChartData=function(c,h,d){var b=$.datepicker.parseDate("yy/m/d",$("meta[name=citation_date]").attr("content"));publishDatems=b.getTime();if(this.isNewArticle(publishDatems)){$("#"+h).html("This article was only recently published. Although we update our data on a daily basis (not in real time), there may be a 48-hour delay before the most recent numbers are available.<br/><br/>");$("#"+h).show("blind",500);$("#"+d).fadeOut("slow")
}else{if(this.isArticle(c)){var e=function(i){$("#"+d).fadeOut("slow");$("#"+h).html('<img src="/images/icon_error.png"/>&nbsp;'+i);$("#"+h).show("blind",500)};var g=function(j){var q=$("#"+h);$("#"+d).fadeOut("slow");q.css("display","none");var E=this.massageChartData(j[0].sources,publishDatems);var w=$('<div id="pageViewsSummary"><div id="left"><div class="header">Total Article Views</div><div class="totalCount">'+E.total.format(0,".",",")+'</div><div class="pubDates">'+$.datepicker.formatDate("M d, yy",b)+" (publication date)<br>through "+$.datepicker.formatDate("M d, yy",new Date())+'*</div></div><div id="right"><table id="pageViewsTable"><tbody><tr><th></th><th nowrap="">HTML Page Views</th><th nowrap="">PDF Downloads</th><th nowrap="">XML Downloads</th><th>Totals</th></tr><tr><td class="source1">PLOS</td><td>'+E.totalCounterHTML.format(0,".",",")+"</td><td>"+E.totalCounterPDF.format(0,".",",")+"</td><td>"+E.totalCounterXML.format(0,".",",")+'</td><td class="total">'+E.totalCouterTotal.format(0,".",",")+'</td></tr><tr><td class="source2">PMC</td><td>'+E.totalPMCHTML.format(0,".",",")+"</td><td>"+E.totalPMCPDF.format(0,".",",")+'</td><td>n.a.</td><td class="total">'+E.totalPMCTotal.format(0,".",",")+'</td></tr><tr><td>Totals</td><td class="total">'+E.totalHTML.format(0,".",",")+'</td><td class="total">'+E.totalPDF.format(0,".",",")+'</td><td class="total">'+E.totalXML.format(0,".",",")+'</td><td class="total">'+E.total.format(0,".",",")+'</td></tr><tr class="percent"><td colspan="5"><b>'+((E.totalPDF/E.totalHTML)*100).format(2,".",",")+"%</b> of article views led to PDF downloads</td></tr></tbody></table></div></div>");var D=$.map(E.history,function(G,i){return i});q.append(w);var m=Object.keys(E.history).length>1;if(m){var n={chart:{renderTo:"chart",animation:false,margin:[40,40,40,80]},credits:{enabled:false},exporting:{enabled:false},title:{text:null},legend:{enabled:false},xAxis:{title:{text:"Months",style:{fontFamily:"'FS Albert Web Regular', Verdana, sans-serif",fontWeight:"normal",color:"#000"},align:"high"},labels:{step:(D.length<15)?1:Math.round(D.length/15),formatter:function(){return this.value+1}},categories:[]},yAxis:[{title:{text:"Cumulative Views",style:{fontFamily:"'FS Albert Web Regular', Verdana, sans-serif",fontWeight:"normal",color:"#000",height:"50px"}},labels:{style:{color:"#000"}}}],plotOptions:{column:{stacking:"normal"},animation:false,series:{pointPadding:0,groupPadding:0,borderWidth:0,shadow:false}},series:[{name:"PMC",type:"column",data:[],color:"#6d84bf"},{name:"PLOS",type:"column",data:[],color:"#3c63af"}],tooltip:{backgroundColor:"rgba(255, 255, 255, 0.0)",useHTML:true,shared:true,shadow:false,borderWidth:0,borderRadius:0,positioner:function(J,G,i){var I=i.plotX+(G/2)+25,H=i.plotY-(J/2)+25;return{x:I,y:H}},formatter:function(){var i=this.points[0].key,G=E.history;return'<table id="mini" cellpadding="0" cellspacing="0"><tr><th></td><td colspan="2">Views in '+$.datepicker.formatDate("M yy",new Date(G[i].year,G[i].month-1,2))+'</td><td colspan="2">Views through '+$.datepicker.formatDate("M yy",new Date(G[i].year,G[i].month-1,2))+'</td></tr><tr><th>Source</th><th class="header1">PLOS</th><th class="header2">PMC</th><th class="header1">PLOS</th><th class="header2">PMC</th></tr><tr><td>HTML</td><td class="data1">'+G[i].source.counterViews.totalHTML+'</td><td class="data2">'+(G[i].source.hasOwnProperty("pmcViews")?G[i].source.pmcViews.totalHTML.format(0,".",","):"n.a.")+'</td><td class="data1">'+G[i].source.counterViews.cumulativeHTML.format(0,".",",")+'</td><td class="data2">'+(G[i].source.hasOwnProperty("pmcViews")?G[i].source.pmcViews.cumulativeHTML.format(0,".",","):"n.a.")+'</td></tr><tr><td>PDF</td><td class="data1">'+G[i].source.counterViews.totalPDF+'</td><td class="data2">'+(G[i].source.hasOwnProperty("pmcViews")?G[i].source.pmcViews.totalPDF.format(0,".",","):"n.a.")+'</td><td class="data1">'+G[i].source.counterViews.cumulativePDF.format(0,".",",")+'</td><td class="data2">'+(G[i].source.hasOwnProperty("pmcViews")?G[i].source.pmcViews.cumulativePDF.format(0,".",","):"n.a.")+'</td></tr><tr><td>XML</td><td class="data1">'+G[i].source.counterViews.totalXML+'</td><td class="data2">n.a.</td><td class="data1">'+G[i].source.counterViews.cumulativeXML.format(0,".",",")+'</td><td class="data2">n.a.</td></tr><tr><td>Total</td><td class="data1">'+G[i].source.counterViews.total+'</td><td class="data2">'+(G[i].source.hasOwnProperty("pmcViews")?G[i].source.pmcViews.total.format(0,".",","):"n.a.")+'</td><td class="data1">'+G[i].source.counterViews.cumulativeTotal.format(0,".",",")+'</td><td class="data2">'+(G[i].source.hasOwnProperty("pmcViews")?G[i].source.pmcViews.cumulativeTotal.format(0,".",","):"n.a.")+"</td></tr></table>"}}};for(var F in E.history){if(E.history[F].source.pmcViews!=null){n.series[0].data.push({name:F,y:E.history[F].source.pmcViews.cumulativeTotal})}else{n.series[0].data.push({name:F,y:0})}n.series[1].data.push({name:F,y:E.history[F].source.counterViews.cumulativeTotal})
}q.append($('<div id="chart"></div>').css("width","600px").css("height","200px"));var t=new Highcharts.Chart(n);if(E.relativeMetricData!=null){var r=E.relativeMetricData.subject_areas;if(r&&r.length>0){var u=new Array();for(var x=0;x<r.length;x++){var o=r[x].subject_area;var z=r[x].average_usage;if(z.length>=2){u.push(o);if(z.length>D.length){z=z.slice(0,D.length)}t.addSeries({id:o,data:z,type:"line",color:"#01DF01",marker:{enabled:false,states:{hover:{enabled:false}}}});t.get(o).hide()}}if(u.length>0){var A;var B=$('<select id="subject_areas"></select>');u.sort();for(x=0;x<u.length;x++){var v=u[x].substr(1);var y=v.split("/");if(y.length==1){B.append($("<option></option>").attr("value",u[x]).text(y[0]))}else{if(y.length==2){B.append($("<option></option>").attr("value",u[x]).html("&nbsp;&nbsp;&nbsp;"+y[1]));if(A==null){A=u[x]}}}}if(A==null){A=u[0]}B.find('option[value="'+A+'"]').attr("selected","selected");t.get(A).show();B.change(function(){$("#subject_areas option").each(function(){t.get($(this).val()).hide()});t.get($(this).val()).show();var i=$('input[name="refsetLinkValue"]').val();$("#linkToRefset").attr("href",i.replace("SUBJECT_AREA",$(this).val()))});var k=$("<div></div>").html('<span class="colorbox"></span>&nbsp;Compare average usage for articles published in <b>'+new Date(E.relativeMetricData.start_date).getUTCFullYear()+'</b> in the subject area: <a href="/static/almInfo#relativeMetrics" class="ir" title="More information">info</a>');var p="/search/advanced?pageSize=12&unformattedQuery=(publication_date:["+E.relativeMetricData.start_date+" TO "+E.relativeMetricData.end_date+']) AND subject:"SUBJECT_AREA"';var s=$("<div></div>").append(B).append('&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;<a id="linkToRefset" href="'+encodeURI(p.replace("SUBJECT_AREA",A))+'" >Show reference set</a>').append('<input type="hidden" name="refsetLinkValue" value="'+encodeURI(p)+'" >');var l=$('<div id="averageViewsSummary"></div>').append(k).append(s);var C=$('<div id="beta">BETA</div>');q.append(C);q.append(l)}}}}q.append($("<p>*Although we update our data on a daily basis, there may be a 48-hour delay before the most recent numbers are available. PMC data is posted on a monthly basis and will be made available once received.</p>"));q.show("blind",500)};c=this.validateDOI(c);var f=c+"&source=pmc,counter,relativemetric&info=event";this.getData(f,jQuery.proxy(g,this),e)}}};this.makeSignPostLI=function(f,e,d,c){var b=$('<li><div class="top">'+e.format(0,".",",")+'</div><div class="bottom"><div class="center"><div class="text">'+f+'<div class="content"><div class="description">'+d+'&nbsp;&nbsp;<a href="'+c+'">Read more</a>.</div></div></div></div></div></li>');(function(){this.hoverEnhanced({})}).apply(b);return b};this.setMetricsTab=function(c){c=this.validateDOI(c);var d=function(e){this.setCitesSuccess(e,"relatedCites","relatedCitesSpinner");this.setSavedSuccess(e,"relatedBookmarks","relatedBookmarksSpinner");this.setDiscussedSuccess(e,"relatedBlogPosts","relatedBlogPostsSpinner");this.setF1000Success(e,"f1kHeader","f1KSpinner","f1kContent")};var b=function(e){this.setCitesError(e,"relatedCites","relatedCitesSpinner");this.setSavedError(e,"relatedBookmarks","relatedBookmarksSpinner");this.setDiscussedError(e,"relatedBlogPosts","relatedBlogPostsSpinner");this.setF1000Error(e,"f1000","f1000Spinner")};this.getData(c,$.proxy(d,this),$.proxy(b,this))};this.filterSources=function(c,b){validSources=[];for(var d=0;d<c.length;d++){if($.inArray(c[d].name.toLowerCase(),b)>-1){validSources.push(c[d])}}return validSources};this.enforceOrder=function(e,b){var f=[];for(var i=0;i<e.length;i++){f.push(e[i].name)}var g=[];for(var h=0;h<b.length;h++){var c=$.inArray(b[h],f);if(c>-1){g.push(e[c])}}return g}};function onReadyALM(){var e=300,g=172800000;if($("#almSignPost").length>0){var h=new $.fn.alm(),c=$("meta[name=citation_doi]").attr("content"),b=$.datepicker.parseDate("yy/m/d",$("meta[name=citation_date]").attr("content")),i=b.getTime();var f=function(j){$("#almSignPostSpinner").css("display","none");if(i>((new Date().getTime())-g)){}else{$("#almSignPost").append($("<li></li>").text("metrics unavailable").css("vertical-align","middle"));$("#almSignPost").fadeIn(e)}};var d=function(q){if(q&&q.length>0){responseObject=q[0];var j,k,p,o,m,w,t,n;sources=responseObject.sources;for(var r=0;r<sources.length;r+=1){source=sources[r];if(source.name.toLowerCase()=="counter"){j=source}else{if(source.name.toLowerCase()=="pmc"){k=source}else{if(source.name.toLowerCase()=="scopus"){p=source}else{if(source.name.toLowerCase()=="facebook"){o=source}else{if(source.name.toLowerCase()=="twitter"){m=source}else{if(source.name.toLowerCase()=="mendeley"){w=source}else{if(source.name.toLowerCase()=="citeulike"){t=source}else{if(source.name.toLowerCase()=="crossref"){n=source}}}}}}}}}u=h.makeSignPostLI("VIEWS",j.metrics.total+k.metrics.total,"Sum of PLOS and PubMed Central page views and downloads","/static/almInfo#usageInfo");$("#almSignPost").append(u);var v,u;
if(p.metrics.total>0){v="CITATIONS";if(p.metrics.total==1){v="CITATION"}u=h.makeSignPostLI(v,p.metrics.total,"Paper's citation count computed by Scopus","/static/almInfo#citationInfo");$("#almSignPost").append(u)}else{if(n.metrics.total>0){v="CITATIONS";if(n.metrics.total==1){v="CITATION"}u=h.makeSignPostLI(v,n.metrics.total,"Scopus data unavailable. Displaying Crossref citation count","/static/almInfo#citationInfo");$("#almSignPost").append(u)}}var l=w.metrics.total+t.metrics.total;if(l>0){v="SAVES";if(l==1){v="SAVE"}u=h.makeSignPostLI(v,w.metrics.total+t.metrics.total,"Total Mendeley and CiteULike bookmarks","/static/almInfo#socialBookmarks");$("#almSignPost").append(u)}var s=o.metrics.total+m.metrics.total;if(s>0){v="SHARES";if(s==1){v="SHARE"}u=h.makeSignPostLI(v,o.metrics.total+m.metrics.total,"Sum of Facebook and Twitter activity","/static/almInfo#socialBookmarks");$("#almSignPost").append(u)}$("#almSignPost").fadeIn(e)}};h.getArticleSummaries([c],d,f)}}$(document).ready(onReadyALM);function onLoadALM(){var c=new $.fn.alm();var b=$("meta[name=citation_doi]").attr("content");c.setMetricsTab(b);c.setChartData(b,"usage","chartSpinner")};